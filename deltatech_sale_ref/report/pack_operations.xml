<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>

<!-- Basic XML report -->
<report
    id="xml_report_action"
    name="deltatech_sale_ref.packing_xml"
    string="XML Report"
    report_type="qweb-xml"
    model="stock.picking"/>

<template id="packing_xml">
    <t t-call="report_xml.utf8_header">
        <t t-foreach="docs" t-as="p">
<!--            <!DOCTYPE SdDataSlice SYSTEM "m2Data_Partner.dtd">-->
            <SdDataSlice>
                <SdCompanyHeader>
                    <LegalName t-esc="'CALZEDONIA s.p.a.'" />
                    <Group t-esc="'CALZEDONIANEW'" />
                    <TransmissionDate t-esc="datetime.datetime.now().strftime('%d-%m-%Y')" />
                </SdCompanyHeader>
                <SdPackingSlip>
                    <t t-set="so_date_year" t-value="p.sale_id.date_order[0:4]"/>
                    <t t-set="so_date_month" t-value="p.sale_id.date_order[5:7]"/>
                    <t t-set="so_date_day" t-value="p.sale_id.date_order[8:10]"/>
                    <t t-set="delivery_date_year" t-value="p.min_date[0:4]"/>
                    <t t-set="delivery_date_month" t-value="p.min_date[5:7]"/>
                    <t t-set="delivery_date_day" t-value="p.min_date[8:10]"/>
                    <t t-set="so_date" t-value="so_date_day + '-' + so_date_month + '-' + so_date_year" />
                    <t t-set="delivery_date" t-value="delivery_date_day + '-' + delivery_date_month + '-' + delivery_date_year" />
                    <PartnerId t-esc="'0000001877'" />
                    <PackingSlipNumber t-esc="p.name.split('/')[-1]" />
                    <FgOutbound t-esc="'false'" />
                    <PackingSlipDate t-esc="delivery_date" />
                    <DeliveryDate t-esc="delivery_date" />
                    <note t-esc="''"/>
                    <t t-set="line_nr" t-value="1" />
                    <SdPackingSlipLine t-foreach="p.pack_operation_ids" t-as="pack">
                        <PackingSlipLineNumber t-esc="'1-'+str(line_nr)" />
                        <OrderTypeName t-esc="'ZA6A'" />
                        <OrderNumber t-esc="p.sale_id.client_order_ref" />
                        <OrderDate t-esc="so_date" />
                        <OrderLineNumber t-esc="pack.ref" />
                        <Qty t-esc="pack.product_qty" />
                        <ProductCode t-esc="pack.product_id.default_code" />
                        <AuxRow1 t-esc="'1'" />
                        <AuxRow2 t-esc="pack.label_sequence" />
                        <AuxRow3 t-esc="'BOX'" />
                        <AuxRow4 t-esc="pack.product_id.name" />
                        <AuxRow5 t-esc="pack.product_uom_id.name" />
                        <AuxRowNum1 t-esc="line_nr" />
                        <AuxRowNum2 t-esc="pack.product_id.pack_weight" />
                        <AuxRowNum3 t-esc="pack.product_id.pack_weight_neto" />
                        <t t-set="move_qty" t-value="''" />
                        <t t-if="pack.linked_move_operation_ids">
                            <t t-set="move_qty" t-value="pack.linked_move_operation_ids[0].move_id.product_qty" />
                        </t>
                        <AuxRowNum4 t-esc="move_qty" />
                        <t t-set="line_nr" t-value="line_nr+1" />
                    </SdPackingSlipLine>
                </SdPackingSlip>
            </SdDataSlice>
        </t>
    </t>
</template>
</data>
</openerp>
